import{d as S,c as f,a as c,w as h,C as O,b as z,r as $,o as _,e as m,t as N,f as F,u as R,g as Z,h as q,F as T,i as P,j as K,_ as A,k as J,l as u,E as x,m as E,p as k,n as Q,q as U,s as W,v as X,x as Y,y as V,z as ee,A as te,B as oe,D as ne,G as se,H as ae}from"./index-C7O8hxmp.js";import{A as ce}from"./AttrList-DKngrgwd.js";import{g as j,s as re}from"./Runtime.vue_vue_type_script_setup_true_lang-B41fe3tz.js";import{J as le,F as de,e as ie}from"./FileSaver.min-01jtPdwu.js";import{_ as pe}from"./Stage.vue_vue_type_style_index_0_lang-EHdFr0qm.js";const me={class:"lc-comp-tree"},ue={class:"flex flex-row items-center space-x-2"},fe=S({__name:"CompTree",props:{elements:{}},emits:["select","change"],setup(e,{emit:t}){const o=e,a=t,C={key:"id",label:"compCode",children:"elements"};function g(l){a("select",l)}function r(l,n,v,d){a("change",o.elements)}function D(l,n,v){return v=="inner"&&n.data.compType!==O.Layout?!1:!(n.data.compCode===z.Page&&v!=="inner")}const b=(l,n)=>{q(o.elements,n.id)};return(l,n)=>{const v=$("el-icon"),d=$("el-tree");return _(),f("div",me,[c(d,{data:l.elements,props:C,"expand-on-click-node":!1,"allow-drop":D,"highlight-current":"","default-expand-all":"",draggable:"",onNodeClick:g,onNodeDrop:r},{default:h(({node:s,data:i})=>[m("span",ue,[m("span",null,N(s.label),1),c(v,{class:"ml-2 hover:text-red-500",onClick:F(p=>b(s,i),["stop"])},{default:h(()=>[c(R(Z))]),_:2},1032,["onClick"])])]),_:1},8,["data"])])}}}),_e={class:"lc-comp-list"},Ce=["data-comp-code"],ge=S({__name:"CompGroups",props:{groups:{}},setup(e){function t(o){console.log("dragstart",o,o.target.dataset.compCode),o.dataTransfer.setData("compCode",o.target.dataset.compCode),console.log(o.dataTransfer.getData("compCode"))}return(o,a)=>(_(),f("div",_e,[(_(!0),f(T,null,P(o.groups,(C,g)=>(_(),f(T,{key:g},[m("div",null,N(g),1),(_(!0),f(T,null,P(C,r=>(_(),f(T,{key:r.compCode},[r.hidden?K("",!0):(_(),f("div",{key:0,class:"lc-comp",draggable:"true","data-comp-code":r.compCode,onDragstart:t},N(r.title||r.compCode),41,Ce))],64))),128))],64))),128))]))}}),ve=A(ge,[["__scopeId","data-v-24e6d410"]]);function he(e,t){const o=new le;for(let a in t)o.file(a,t[a]);o.generateAsync({type:"blob"}).then(function(a){de.saveAs(a,e+".zip")})}const ye={class:"lc-designer-header"},we=S({__name:"EditorHeader",props:{elements:{}},emits:["reset"],setup(e,{emit:t}){const o=t,a=e,C=J("mode",u("edit"));function g(){const n=j();o("reset",n),x("reset: "+JSON.stringify(n))}function r(){const n=re(a.elements);x("save: "+n)}function D(){const n=j();o("reset",n),x("init: "+JSON.stringify(n))}function b(){C.value="preview"}async function l(){const n=await ie(a.elements);he("vlowCode",{"test.vue":n})}return(n,v)=>{const d=$("el-button");return _(),f("div",ye,[c(d,{onClick:D},{default:h(()=>[E("初始化")]),_:1}),c(d,{onClick:g},{default:h(()=>[E("重置")]),_:1}),c(d,{onClick:r},{default:h(()=>[E("保存")]),_:1}),c(d,{onClick:l},{default:h(()=>[E("页面导出")]),_:1}),c(d,{onClick:b},{default:h(()=>[E("预览")]),_:1})])}}}),De=A(we,[["__scopeId","data-v-8f0f2816"]]);function G(e,t){for(;e;){if(e.classList.contains(t))return e;if(e.classList.contains("lc-stage"))return null;e=e.parentElement}return e}function be(e){return G(e,"lc-layout")}function Ee(e){return G(e,"lc-comp")}function ke(e){return e.getAttribute("lc-id")}function xe(){let e=J("selectComp");e||(e=u({data:{}}),k("selectComp",e));const t=e;function o(a){t.value=a}return{selectedCompRef:t,setSelectedComp:o}}const Te={class:"lc-designer"},Se={class:"lc-designer-header"},$e={class:"lc-designer-body"},Ne={class:"lc-designer-body-item left"},Re={class:"lc-designer-body-item-item top"},je={class:"lc-designer-body-item-item bottom"},Ae={class:"lc-designer-body-item right"},Be=S({__name:"Editor",setup(e){const t=u([{compCode:"LcPage",id:"null",compType:3,data:{}}]),o=u(null);k("allElements",t);const a=u([]);k("pageTreeData",a);const C=u("edit");k("mode",C);const g=u([{name:"hello",type:"function",content:`function hello(a,b,c){
        console.log('print world')
        return a+b+c
    }`},{name:"world",type:"function",content:`function world(){
        console.log('print world')
    }`}]);k("fnTreeData",g),Q(()=>{var s;a.value=se(((s=t.value[0])==null?void 0:s.data.variables)||{})}),u(ae);function r(s){t.value=s}function D(s){var I;if(C.value!=="edit")return;const i=(I=s.dataTransfer)==null?void 0:I.getData("compCode");if(!i)return;let p;const B=be(s.target);if(B!=null){const H=Ee(B),M=ke(H);p=Y(t.value,M)}p==null&&(p=t.value[0]),p.elements==null&&(p.elements=[]);const y=V(p.compCode);if(y.childCompCodes&&!y.childCompCodes.includes(i))throw x.error(y.compCode+"只能添加"+y.childCompCodes.join(",")),new Error(y.compCode+"只能添加"+y.childCompCodes.join(","));const w=V(i);if(w.parentCompCodes&&!w.parentCompCodes.includes(i))throw x.error(w.compCode+"只能放入"+w.parentCompCodes.join(",")),new Error(w.compCode+"只能放入"+w.parentCompCodes.join(","));const L=ee(i);if(!L)throw new Error("未找到父节点");p.elements.push(L)}function b(s){console.log(s)}const l=u([{title:"标题",name:"title",component:"el-input"}]),{selectedCompRef:n,setSelectedComp:v}=xe();function d(s){v(s),l.value=te(s.compCode)}return U(()=>n.value,s=>{console.log("val",s)}),W(()=>{const s=j();t.value=s}),(s,i)=>{const p=oe("fullscreen");return _(),f("div",Te,[m("div",Se,[c(De,{elements:t.value,onReset:r},null,8,["elements"])]),m("div",$e,[m("div",Ne,[m("div",Re,[c(ve,{groups:R(ne)},null,8,["groups"])]),m("div",je,[c(fe,{ref_key:"compTreeRef",ref:o,elements:t.value,onSelect:d,onChange:b},null,8,["elements"])])]),m("div",{class:"lc-designer-body-item center lc-stage","drag-end":"",onDrop:D,onDragover:i[0]||(i[0]=F(()=>{},["prevent"]))},[c(pe)],32),m("div",Ae,[X(c(ce,{attrs:l.value,data:R(n).data},null,8,["attrs","data"]),[[p]])])])])}}}),Je=A(Be,[["__scopeId","data-v-c56461cc"]]);export{Je as default};
