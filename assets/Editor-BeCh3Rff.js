import{d as S,c as f,a as c,w as h,C as z,b as H,r as $,o as _,e as m,t as N,f as F,u as R,g as Z,h as q,F as T,i as P,j as K,_ as A,k as J,l as u,E as x,m as E,p as k,n as Q,q as U,s as W,v as X,x as V,y as Y,z as ee,A as te,B as oe,D as ne,G as se}from"./index-DnPDpxWP.js";import{A as ae}from"./AttrList-DmVGWqzH.js";import{g as j,s as ce}from"./Runtime.vue_vue_type_script_setup_true_lang-IVHBB4WU.js";import{J as re,F as le,e as ie}from"./FileSaver.min-BLwjdsVG.js";import{_ as de}from"./Stage.vue_vue_type_style_index_0_lang-WIXuroz-.js";const pe={class:"lc-comp-tree"},me={class:"flex flex-row items-center space-x-2"},ue=S({__name:"CompTree",props:{elements:{}},emits:["select","change"],setup(e,{emit:t}){const s=e,a=t,C={key:"id",label:"compCode",children:"elements"};function g(l){a("select",l)}function r(l,o,v,i){a("change",s.elements)}function b(l,o,v){return v=="inner"&&o.data.compType!==z.Layout?!1:!(o.data.compCode===H.Page&&v!=="inner")}const D=(l,o)=>{q(s.elements,o.id)};return(l,o)=>{const v=$("el-icon"),i=$("el-tree");return _(),f("div",pe,[c(i,{data:l.elements,props:C,"expand-on-click-node":!1,"allow-drop":b,"highlight-current":"","default-expand-all":"",draggable:"",onNodeClick:g,onNodeDrop:r},{default:h(({node:n,data:d})=>[m("span",me,[m("span",null,N(n.label),1),c(v,{class:"ml-2 hover:text-red-500",onClick:F(p=>D(n,d),["stop"])},{default:h(()=>[c(R(Z))]),_:2},1032,["onClick"])])]),_:1},8,["data"])])}}}),fe={class:"lc-comp-list"},_e=["data-comp-code"],Ce=S({__name:"CompGroups",props:{groups:{}},setup(e){function t(s){s.dataTransfer.setData("compCode",s.target.dataset.compCode)}return(s,a)=>(_(),f("div",fe,[(_(!0),f(T,null,P(s.groups,(C,g)=>(_(),f(T,{key:g},[m("div",null,N(g),1),(_(!0),f(T,null,P(C,r=>(_(),f(T,{key:r.compCode},[r.hidden?K("",!0):(_(),f("div",{key:0,class:"lc-comp",draggable:"true","data-comp-code":r.compCode,onDragstart:t},N(r.title||r.compCode),41,_e))],64))),128))],64))),128))]))}}),ge=A(Ce,[["__scopeId","data-v-56ece8e3"]]);function ve(e,t){const s=new re;for(let a in t)s.file(a,t[a]);s.generateAsync({type:"blob"}).then(function(a){le.saveAs(a,e+".zip")})}const he={class:"lc-designer-header"},ye=S({__name:"EditorHeader",props:{elements:{}},emits:["reset"],setup(e,{emit:t}){const s=t,a=e,C=J("mode",u("edit"));function g(){const o=j();s("reset",o),x("reset: "+JSON.stringify(o))}function r(){const o=ce(a.elements);x("save: "+o)}function b(){const o=j();s("reset",o),x("init: "+JSON.stringify(o))}function D(){C.value="preview"}async function l(){const o=await ie(a.elements);ve("vlowCode",{"test.vue":o})}return(o,v)=>{const i=$("el-button");return _(),f("div",he,[c(i,{onClick:b},{default:h(()=>[E("初始化")]),_:1}),c(i,{onClick:g},{default:h(()=>[E("重置")]),_:1}),c(i,{onClick:r},{default:h(()=>[E("保存")]),_:1}),c(i,{onClick:l},{default:h(()=>[E("页面导出")]),_:1}),c(i,{onClick:D},{default:h(()=>[E("预览")]),_:1})])}}}),we=A(ye,[["__scopeId","data-v-8f0f2816"]]);function G(e,t){for(;e;){if(e.classList.contains(t))return e;if(e.classList.contains("lc-stage"))return null;e=e.parentElement}return e}function be(e){return G(e,"lc-layout")}function De(e){return G(e,"lc-comp")}function Ee(e){return e.getAttribute("lc-id")}function ke(){let e=J("selectComp");e||(e=u({data:{}}),k("selectComp",e));const t=e;function s(a){t.value=a}return{selectedCompRef:t,setSelectedComp:s}}const xe={class:"lc-designer"},Te={class:"lc-designer-header"},Se={class:"lc-designer-body"},$e={class:"lc-designer-body-item left"},Ne={class:"lc-designer-body-item-item top"},Re={class:"lc-designer-body-item-item bottom"},je={class:"lc-designer-body-item right"},Ae=S({__name:"Editor",setup(e){const t=u([{compCode:"LcPage",id:"null",compType:3,data:{}}]),s=u(null);k("allElements",t);const a=u([]);k("pageTreeData",a);const C=u("edit");k("mode",C);const g=u([{name:"hello",type:"function",content:`function hello(a,b,c){
        console.log('print world')
        return a+b+c
    }`},{name:"world",type:"function",content:`function world(){
        console.log('print world')
    }`}]);k("fnTreeData",g),Q(()=>{var n;a.value=ne(((n=t.value[0])==null?void 0:n.data.variables)||{})}),u(se);function r(n){t.value=n}function b(n){var I;if(C.value!=="edit")return;const d=(I=n.dataTransfer)==null?void 0:I.getData("compCode");if(!d)return;let p;const B=be(n.target);if(B!=null){const M=De(B),O=Ee(M);p=X(t.value,O)}p==null&&(p=t.value[0]),p.elements==null&&(p.elements=[]);const y=V(p.compCode);if(y.childCompCodes&&!y.childCompCodes.includes(d))throw x.error(y.compCode+"只能添加"+y.childCompCodes.join(",")),new Error(y.compCode+"只能添加"+y.childCompCodes.join(","));const w=V(d);if(w.parentCompCodes&&!w.parentCompCodes.includes(d))throw x.error(w.compCode+"只能放入"+w.parentCompCodes.join(",")),new Error(w.compCode+"只能放入"+w.parentCompCodes.join(","));const L=Y(d);if(!L)throw new Error("未找到父节点");p.elements.push(L)}function D(n){console.log(n)}const l=u([{title:"标题",name:"title",component:"el-input"}]),{selectedCompRef:o,setSelectedComp:v}=ke();function i(n){v(n),l.value=ee(n.compCode)}return U(()=>{const n=j();t.value=n}),(n,d)=>{const p=te("fullscreen");return _(),f("div",xe,[m("div",Te,[c(we,{elements:t.value,onReset:r},null,8,["elements"])]),m("div",Se,[m("div",$e,[m("div",Ne,[c(ge,{groups:R(oe)},null,8,["groups"])]),m("div",Re,[c(ue,{ref_key:"compTreeRef",ref:s,elements:t.value,onSelect:i,onChange:D},null,8,["elements"])])]),m("div",{class:"lc-designer-body-item center lc-stage","drag-end":"",onDrop:b,onDragover:d[0]||(d[0]=F(()=>{},["prevent"]))},[c(de)],32),m("div",je,[W(c(ae,{attrs:l.value,data:R(o).data},null,8,["attrs","data"]),[[p]])])])])}}}),Fe=A(Ae,[["__scopeId","data-v-49b54f56"]]);export{Fe as default};
